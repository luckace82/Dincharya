{% extends 'base.html' %}

{% block title %}Ticket #{{ ticket.id }} - Support{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="card mb-3">
        <div class="card-body">
            <h3>{{ ticket.subject }}</h3>
            <p style="color:#555; white-space:pre-line;">{{ ticket.description }}</p>
            <div style="color:#777; font-size:13px; margin-top:8px;">Submitted by {{ ticket.created_by.get_full_name|default:ticket.created_by.username }} • {{ ticket.created_at|date:"M d, Y H:i" }}</div>
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body">
            <h5>Replies</h5>
            {% for r in replies %}
                <div style="border-bottom:1px solid #f1f1f1; padding:10px 0;">
                    <div style="font-weight:600">{{ r.responder.get_full_name|default:r.responder.username }} <small style="color:#777; font-weight:400">• {{ r.created_at|date:"M d, Y H:i" }}</small></div>
                    <div style="margin-top:6px; white-space:pre-line; color:#333">{{ r.message }}</div>
                </div>
            {% empty %}
                <div>No replies yet.</div>
            {% endfor %}
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5>Post a reply</h5>
            <p class="text-muted">As a supervisor you can reply to the intern and provide suggested solutions. This will notify the intern via email.</p>
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    {{ form.message.label_tag }}
                    {{ form.message }}
                    {{ form.message.errors }}
                </div>
                <button type="submit" class="btn btn-primary">Send Reply</button>
                <a href="{% url 'support_list' %}" class="btn btn-outline-secondary ms-2">Back to tickets</a>
            </form>
        </div>
    </div>
</div>
{% endblock %}
